<% layout('/layouts/boilerplate') %>

<style>
  .font-manrope { font-family: 'Manrope', sans-serif; }
  
  .material-symbols-outlined { 
    font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; 
  }

  /* Brand Gradient Sync */
  .brand-gradient { 
    background: linear-gradient(135deg, #00B0FF 0%, #673ab6 100%) !important; 
  }

  /* Responsive Typography */
  h1 { font-size: 1.25rem !important; font-weight: 900 !important; letter-spacing: -0.025em; }
  h2 { font-size: 0.9rem !important; font-weight: 700 !important; }
  h3 { font-size: 0.8rem !important; font-weight: 800 !important; }
  
  @media (min-width: 768px) {
    h1 { font-size: 1.5rem !important; }
    h2 { font-size: 1rem !important; }
  }
  
  .text-label { font-size: 0.65rem; font-weight: 800; color: #1e293b; text-transform: uppercase; letter-spacing: 0.05em; }
  .text-xs-sync { font-size: 0.6rem; color: #64748b; font-weight: 600; }

  /* Tab Navigation - Optimized for Mobile Scroll */
  .tab-btn-sync {
    font-size: 0.65rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.08em;
    padding: 0 0.25rem 0.6rem 0.25rem; border-bottom: 2px solid transparent; transition: all 0.3s ease;
    color: #94a3b8; background: transparent; border-top: none; border-left: none; border-right: none;
    cursor: pointer; white-space: nowrap;
  }
  .tab-btn-sync.active { border-bottom-color: #673ab6; color: #1e293b; }
  .tab-section { display: none; }
  .tab-section.active { display: block; }

  /* Cards & Layout */
  .dash-card {
    background: white; border: 1px solid #f1f5f9;
    border-radius: 1rem; transition: all 0.3s ease;
    overflow: hidden;
  }
  
  .listing-thumb {
    width: 100%; height: 160px; object-fit: cover;
    border-bottom: 1px solid #f8fafc;
  }

  .hide-scrollbar::-webkit-scrollbar { display: none; }
  .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
</style>

<div class="bg-white font-manrope text-slate-900 antialiased min-h-screen pb-12">
  <main class="max-w-6xl mx-auto px-4 md:px-12 py-6 md:py-8">
    
    <nav class="flex items-center gap-1 mb-6 text-[9px] font-bold uppercase tracking-wider text-gray-400">
      <a href="/listings" class="hover:text-indigo-600">Wanderlust</a>
      <span class="material-symbols-outlined text-[10px]">chevron_right</span>
      <span class="text-slate-900">Host Dashboard</span>
    </nav>

    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-10">
      <div class="flex items-center gap-4">
        <div class="size-14 md:size-20 rounded-2xl bg-slate-50 border border-slate-100 flex items-center justify-center text-slate-300 font-black text-xl md:text-2xl shadow-sm overflow-hidden flex-shrink-0">
           <% if (currUser && currUser.profileImage) { %>
              <img src="<%= currUser.profileImage %>" class="w-full h-full object-cover">
           <% } else { %>
              <%= user?.username?.charAt(0) || 'U' %>
           <% } %>
        </div>
        <div>
          <h1 class="text-slate-900 leading-tight">Hello, <%= user?.username || "Host" %></h1>
          <div class="flex flex-wrap items-center gap-x-3 gap-y-1">
             <span class=" mt-2 flex items-center gap-1 text-emerald-500 text-[8px] md:text-[9px] font-black uppercase tracking-widest">
               <span class="material-symbols-outlined !text-[10px] md:!text-xs">verified</span> Verified Host
             </span>
             <a href="/edit" class=" mt-2 text-slate-400 hover:text-indigo-600 text-[8px] md:text-[9px] font-black uppercase tracking-widest flex items-center gap-1">
               <span class="material-symbols-outlined !text-[10px] md:!text-xs">settings</span> Edit Profile
             </a>
          </div>
        </div>
      </div>
      
      <a href="/listings/new" class="brand-gradient text-white px-5 py-2 rounded-xl text-[9px] font-black shadow-lg shadow-indigo-100 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2">
        <span class="material-symbols-outlined !text-sm">add_box</span> ADD NEW LISTING
      </a>
    </div>

    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mb-10">
      <div class="dash-card p-4 md:p-5">
        <p class="text-label mb-2">Listings</p>
        <h2 class="!text-xl md:!text-2xl font-black"><%= totalListings %></h2>
      </div>
      <div class="dash-card p-4 md:p-5">
        <p class="text-label mb-2">Bookings</p>
        <h2 class="!text-xl md:!text-2xl font-black"><%= totalBookings %></h2>
      </div>
      <div class="dash-card p-4 md:p-5">
        <p class="text-label mb-2">Rating</p>
        <div class="flex items-center gap-1">
          <h2 class="!text-xl md:!text-2xl font-black">4.9</h2>
          <span class="material-symbols-outlined text-yellow-400 !text-sm md:!text-base">star</span>
        </div>
      </div>
      <div class="dash-card p-4 md:p-5">
        <p class="text-label mb-2">Status</p>
        <h2 class="!text-[10px] md:!text-xs font-black text-indigo-600 uppercase">Superhost</h2>
      </div>
    </div>

    <div class="border-b border-slate-100 mb-6 flex gap-6 overflow-x-auto hide-scrollbar scroll-smooth">
      <button class="tab-btn-sync active" data-tab="listings">Properties</button>
      <button class="tab-btn-sync" data-tab="bookings">Bookings</button>
      <button class="tab-btn-sync" data-tab="reviews">Reviews</button>
    </div>

    <div class="host-content">
      
      <section class="tab-section active" id="listings">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
          <% if(listings.length === 0) { %>
            <div class="col-span-full text-center py-16 border-2 border-dashed border-slate-100 rounded-3xl">
              <p class="text-slate-400 font-bold text-[10px] uppercase tracking-widest">No Properties Listed</p>
            </div>
          <% } else { %>
            <% listings.forEach(listing => { %>
              <div class="dash-card group">
                <img src="<%= listing.image?.url || '/images/default.jpg' %>" class="listing-thumb" />
                <div class="p-4">
                  <span class="text-[8px] font-black text-indigo-500 uppercase tracking-widest mb-1 block"><%= listing.location %></span>
                  <h3 class="line-clamp-1 mb-3 text-slate-900"><%= listing.title %></h3>
                  
                  <div class="flex items-center justify-between pt-3 border-t border-slate-50">
                     <p class="text-xs font-black text-slate-900">â‚¹<%= listing.price.toLocaleString("en-IN") %><span class="text-[9px] text-slate-400 font-medium">/nt</span></p>
                     
                     <div class="flex gap-4 items-center">
                       <a href="/listings/<%= listing._id %>/edit" class="text-slate-400 hover:text-indigo-600 transition-colors">
                         <span class="material-symbols-outlined !text-lg">edit_square</span>
                       </a>
                       <a href="/listings/<%= listing._id %>" class="text-slate-400 hover:text-indigo-600 transition-colors">
                         <span class="material-symbols-outlined !text-lg">visibility</span>
                       </a>
                       <form method="POST" action="/listings/<%= listing._id %>?_method=DELETE" class="m-0 flex items-center">
                         <button type="submit" class="text-slate-400 hover:text-red-500 transition-colors border-none bg-transparent p-0 flex items-center cursor-pointer" onclick="return confirm('Permanently delete this property?')">
                           <span class="material-symbols-outlined !text-lg">delete</span>
                         </button>
                       </form>
                     </div>
                  </div>
                </div>
              </div>
            <% }) %>
          <% } %>
        </div>
      </section>

      <section class="tab-section" id="bookings">
        <div class="space-y-3">
          <% if(bookings.length > 0) { %>
            <% bookings.forEach(booking => { %>
              <div class="dash-card p-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="size-9 rounded-xl bg-indigo-50 text-indigo-600 flex items-center justify-center flex-shrink-0">
                    <span class="material-symbols-outlined !text-base">calendar_month</span>
                  </div>
                  <div>
                    <h3 class="!font-bold text-slate-900 leading-none mb-1"><%= booking.listing?.title %></h3>
                    <p class="text-xs-sync">Guest: <%= booking.user?.username %></p>
                  </div>
                </div>
                <div class="text-right flex-shrink-0">
                  <p class="text-[7px] font-black text-slate-400 uppercase">Checkout</p>
                  <p class="text-[10px] font-bold text-slate-900"><%= booking.checkOut.toLocaleDateString() %></p>
                </div>
              </div>
            <% }) %>
          <% } else { %>
            <p class="text-center py-10 text-xs-sync uppercase tracking-widest">No upcoming bookings</p>
          <% } %>
        </div>
      </section>

      <section class="tab-section" id="reviews">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <% if(reviews.length > 0) { %>
            <% reviews.forEach(r => { %>
              <div class="dash-card p-4">
                <div class="flex text-yellow-400 mb-2">
                  <% for(let i=0; i<r.rating; i++) { %><span class="material-symbols-outlined !text-[12px]">star</span><% } %>
                </div>
                <p class="text-xs-sync italic mb-3 leading-relaxed line-clamp-3">"<%= r.comment %>"</p>
                <div class="flex items-center gap-2 pt-3 border-t border-slate-50">
                  <div class="size-5 rounded bg-slate-100 text-[8px] font-black flex items-center justify-center text-slate-400 uppercase">
                    <%= r.author?.username?.charAt(0) %>
                  </div>
                  <span class="text-[8px] font-black uppercase tracking-widest text-slate-900"><%= r.author?.username %></span>
                </div>
              </div>
            <% }) %>
          <% } else { %>
            <p class="text-center py-10 text-xs-sync uppercase tracking-widest">No reviews received</p>
          <% } %>
        </div>
      </section>

    </div>

    <div class="mt-12 flex flex-wrap justify-center gap-x-8 gap-y-4 border-t border-slate-50 pt-8">
      <div class="flex items-center gap-2 text-slate-300">
        <span class="material-symbols-outlined !text-sm">verified_user</span>
        <span class="text-[8px] font-black uppercase tracking-widest">ID Verified</span>
      </div>
      <div class="flex items-center gap-2 text-slate-300">
        <span class="material-symbols-outlined !text-sm">security</span>
        <span class="text-[8px] font-black uppercase tracking-widest">SSL Encrypted</span>
      </div>
    </div>
  </main>
</div>

<script>
  // Tab Swapping logic
  const tabs = document.querySelectorAll(".tab-btn-sync");
  const sections = document.querySelectorAll(".tab-section");

  tabs.forEach(btn => {
    btn.addEventListener("click", () => {
      tabs.forEach(t => t.classList.remove("active"));
      btn.classList.add("active");
      sections.forEach(sec => sec.classList.remove("active"));
      const target = document.getElementById(btn.dataset.tab);
      if(target) target.classList.add("active");
    });
  });
</script>