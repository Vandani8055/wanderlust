<% layout('layouts/boilerplate') %>



<style>
    .glass-card {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .dark .glass-card {
        background: rgba(27, 15, 35, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .soft-shadow {
        box-shadow: 0 10px 25px -5px rgba(110, 0, 189, 0.1);
    }
    .gradient-btn {
        background: linear-gradient(135deg, #2d63ed 0%, #6e00bd 100%);
    }
    body { font-family: 'Manrope', sans-serif; }
</style>

<div class="bg-background-light dark:bg-background-dark min-h-screen pb-20">
    <main class="max-w-7xl mx-auto px-4 md:px-6 py-8">
        <nav class="flex items-center gap-2 text-sm font-medium mb-8 px-2">
            <a class="text-primary hover:underline" href="/listings">Explore</a>
            <span class="material-symbols-outlined text-xs opacity-40">chevron_right</span>
            <span class="text-slate-900 dark:text-white">Book</span>
        </nav>

        <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight mb-10 px-2">Complete Your Booking</h1>

        <form action="/bookings/<%= listing._id %>" method="POST">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
                
                <div class="lg:col-span-7 space-y-10 order-2 lg:order-1">
                    <section>
                        <div class="flex items-center gap-3 mb-6 px-2">
                            <span class="material-symbols-outlined text-primary">event_available</span>
                            <h2 class="text-2xl font-bold">Select Dates</h2>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-white dark:bg-white/5 p-6 md:p-8 rounded-2xl soft-shadow border border-slate-100 dark:border-white/5">
                            <div class="space-y-2">
                                <label class="text-xs font-bold uppercase tracking-wider opacity-60 ml-1">Check-in</label>
                                <div class="relative group">
                                    <input 
                                        class="w-full bg-slate-50 dark:bg-white/5 border-none rounded-xl py-4 px-5 focus:ring-2 focus:ring-primary font-medium transition-all" 
                                        type="date" 
                                        name="checkIn" 
                                        id="checkIn"
                                        min="<%= new Date().toISOString().split('T')[0] %>" 
                                        required
                                    />
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label class="text-xs font-bold uppercase tracking-wider opacity-60 ml-1">Check-out</label>
                                <div class="relative group">
                                    <input 
                                        class="w-full bg-slate-50 dark:bg-white/5 border-none rounded-xl py-4 px-5 focus:ring-2 focus:ring-primary font-medium transition-all" 
                                        type="date" 
                                        name="checkOut" 
                                        id="checkOut"
                                        min="<%= new Date().toISOString().split('T')[0] %>" 
                                        required
                                    />
                                </div>
                            </div>

                            <div class="md:col-span-2 pt-4 border-t border-slate-100 dark:border-white/5">
                                <p class="text-sm text-slate-500 flex items-center gap-2">
                                    <span class="material-symbols-outlined text-emerald-status text-lg">info</span>
                                    You won't be charged yet
                                </p>
                            </div>
                        </div>
                    </section>

                    <section>
                        <div class="flex items-center gap-3 mb-6 px-2">
                            <span class="material-symbols-outlined text-primary">person</span>
                            <h2 class="text-2xl font-bold">Traveler Information</h2>
                        </div>
                        <div class="bg-white dark:bg-white/5 p-6 md:p-8 rounded-2xl soft-shadow border border-slate-100 dark:border-white/5 space-y-6">
                            <p class="text-slate-500 text-sm">Booking as <strong><%= currUser.username %></strong> (<%= currUser.email %>)</p>
                            <div class="space-y-2">
                                <label class="text-xs font-bold uppercase opacity-60 ml-1">Special Requests (Optional)</label>
                                <textarea class="w-full bg-slate-50 dark:bg-white/5 border-none rounded-xl py-3 px-4 focus:ring-2 focus:ring-primary font-medium" placeholder="Dietary requirements, late arrival, etc." rows="3"></textarea>
                            </div>
                        </div>
                    </section>
                </div>

                <div class="lg:col-span-5 order-1 lg:order-2">
                    <div class="glass-card rounded-3xl p-6 sticky top-24 shadow-2xl overflow-hidden border border-white/20">
                        <div class="absolute top-4 right-4 z-10">
                            <div class="flex items-center gap-1.5 bg-emerald-status/10 text-emerald-status px-3 py-1 rounded-full text-xs font-bold border border-emerald-status/20">
                                <span class="material-symbols-outlined text-[14px]">verified</span>
                                Secure Booking
                            </div>
                        </div>

                        <div class="relative h-48 md:h-56 w-full rounded-2xl overflow-hidden mb-6">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"></div>
                            <img class="h-full w-full object-cover" src="<%= listing.image.url %>" alt="<%= listing.title %>"/>
                            <div class="absolute bottom-4 left-4 text-white">
                                <p class="text-[10px] font-bold uppercase tracking-widest opacity-80 mb-1"><%= listing.category || 'Luxury Stay' %></p>
                                <h3 class="text-xl font-extrabold leading-tight"><%= listing.title %></h3>
                                <p class="text-sm opacity-90 flex items-center gap-1">
                                    <span class="material-symbols-outlined text-sm">location_on</span>
                                    <%= listing.location %>, <%= listing.country %>
                                </p>
                            </div>
                        </div>

                        <div class="space-y-4 mb-8">
                            <div class="flex justify-between items-center text-sm">
                                <span class="opacity-60">Price per night</span>
                                <span class="font-bold text-slate-900 dark:text-white">₹<%= listing.price.toLocaleString("en-IN") %></span>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="opacity-60">Service fee</span>
                                <span class="font-bold text-emerald-status">FREE</span>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="opacity-60">Taxes</span>
                                <span class="font-bold text-slate-900 dark:text-white">₹0</span>
                            </div>
                            
                            <div class="h-px bg-slate-200 dark:bg-white/10 my-4"></div>
                            
                            <div class="flex justify-between items-end">
                                <div>
                                    <p class="text-xs font-bold uppercase tracking-widest opacity-60 mb-1">Total to pay</p>
                                    <p class="text-3xl font-extrabold text-primary" id="total-display">₹<%= listing.price.toLocaleString("en-IN") %></p>
                                </div>
                                <span class="text-[10px] opacity-40 font-bold uppercase">INR / Net Price</span>
                            </div>
                        </div>

                        <button type="submit" class="gradient-btn w-full text-white py-4 md:py-5 rounded-2xl font-bold text-lg shadow-lg shadow-primary/20 hover:brightness-110 active:scale-[0.98] transition-all flex items-center justify-center gap-3">
                            Pay with Stripe
                            <span class="material-symbols-outlined">arrow_forward</span>
                        </button>

                        <div class="mt-6 flex items-center justify-center gap-2 opacity-40">
                            <span class="material-symbols-outlined text-sm">lock</span>
                            <span class="text-[10px] font-bold uppercase tracking-widest">Encrypted Checkout</span>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </main>
</div>

<script>
    // Logic to update total based on nights (Optional helper)
    const checkInInput = document.getElementById('checkIn');
    const checkOutInput = document.getElementById('checkOut');
    const totalDisplay = document.getElementById('total-display');
    const basePrice = <%= listing.price %>;

    function calculateTotal() {
        if (checkInInput.value && checkOutInput.value) {
            const start = new Date(checkInInput.value);
            const end = new Date(checkOutInput.value);
            const diffTime = Math.abs(end - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays > 0) {
                const total = diffDays * basePrice;
                totalDisplay.innerText = `₹${total.toLocaleString("en-IN")}`;
            }
        }
    }

    checkInInput.addEventListener('change', calculateTotal);
    checkOutInput.addEventListener('change', calculateTotal);
</script>